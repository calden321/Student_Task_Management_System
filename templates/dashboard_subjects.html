{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="task-list">
        <h2>Your Tasks 
            <small>
                <a href="/dashboard?subject=all" 
                   style="{% if subject_filter == 'all' %}font-weight:bold;{% endif %}">
                   All
                </a>
                {% for subject in subjects %}
                | <a href="/dashboard?subject={{ subject.name }}" 
                     style="{% if subject_filter == subject.name %}font-weight:bold;{% endif %}">
                     {{ subject.name }}
                   </a>
                {% endfor %}
            </small>
        </h2>
        
        <div class="stats">
            <p><strong>üìä Summary:</strong> {{ total_tasks }} total tasks | {{ completed_tasks }} completed | {{ pending_tasks }} pending</p>
            {% if subject_filter != 'all' %}
            <p>Filtered by: <strong>{{ subject_filter }}</strong></p>
            {% endif %}
        </div>
        
        {% if tasks %}
            {% for task in tasks %}
            <div class="task-item {{ task.priority }} {% if task.completed %}completed{% endif %}">
                <h3>{{ task.title }}</h3>
                <p>{{ task.description }}</p>
                <p>
                    üìÖ Due: {{ task.due_date }} | 
                    <span class="priority-badge {{ task.priority }}-badge">{{ task.priority.upper() }}</span> |
                    {% if task.subject_name %}
                    <span style="color: {{ task.subject_color }};">üìö {{ task.subject_name }}</span> |
                    {% endif %}
                    Status: {% if task.completed %}‚úÖ Completed{% else %}‚è≥ Pending{% endif %}
                </p>
                <div>
                    {% if not task.completed %}
                    <form method="POST" action="/complete_task" style="display:inline;">
                        <input type="hidden" name="task_id" value="{{ task.id }}">
                        <button type="submit" class="btn btn-success">Mark Complete</button>
                    </form>
                    {% endif %}
                    <form method="POST" action="/delete_task" style="display:inline;">
                        <input type="hidden" name="task_id" value="{{ task.id }}">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>No tasks yet. Add your first task below!</p>
        {% endif %}
    </div>
    
    <div class="task-form">
        <h2>Add New Task</h2>
        <form method="POST">
            <input type="text" name="title" placeholder="Task title" required>
            <textarea name="description" placeholder="Description" rows="3"></textarea>
            <input type="date" name="due_date" required>
            <select name="priority" required>
                <option value="high">High Priority</option>
                <option value="medium" selected>Medium Priority</option>
                <option value="low">Low Priority</option>
            </select>
            <select name="subject_id">
                <option value="">No Subject</option>
                {% for subject in subjects %}
                <option value="{{ subject.id }}">{{ subject.name }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">Add Task</button>
        </form>
        
        <h2 style="margin-top: 2rem;">Add New Subject</h2>
        <form method="POST">
            <input type="text" name="new_subject" placeholder="Subject name (e.g., Math)" required>
            <button type="submit" class="btn btn-primary">Add Subject</button>
        </form>
        
        {% if subjects %}
        <h3>Your Subjects:</h3>
        <ul>
            {% for subject in subjects %}
            <li>
                {{ subject.name }}
                <a href="/delete_subject/{{ subject.id }}" 
                   onclick="return confirm('Delete {{ subject.name }}?')" 
                   style="color: red; margin-left: 10px;">√ó</a>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
</div>
{% endblock %}